Все добавляемые объекты включаем в подсистему «Настройка»

![Подсистема Настройки](%D0%9F%D0%BE%D0%B4%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0%20%D0%9D%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B8.png)

Добавить перечисление «ТипыНоменклатуры» («Товар», «Услуга»);

![Типы номенклатуры](%D0%A2%D0%B8%D0%BF%D1%8B%20%D0%BD%D0%BE%D0%BC%D0%B5%D0%BD%D0%BA%D0%BB%D0%B0%D1%82%D1%83%D1%80%D1%8B.png)

С перечислением «СтавкиНДС» («БезНДС», «НДС10», «НДС20»);

![Ставки Ндс](%D0%A1%D1%82%D0%B0%D0%B2%D0%BA%D0%B8%20%D0%9D%D0%B4%D1%81.png)

С справочником «НоменклатурныеГруппы»
    без иерархии, с наименованием разумной длины;
    ![Номенклатурные группы](%D0%9D%D0%BE%D0%BC%D0%B5%D0%BD%D0%BA%D0%BB%D0%B0%D1%82%D1%83%D1%80%D0%BD%D1%8B%D0%B5%20%D0%B3%D1%80%D1%83%D0%BF%D0%BF%D1%8B.png)

Добавить справочник «Номенклатура»:
убрать код, дать разумную длину наименованию;
включить иерархию групп и элементов;
добавить реквизиты, включив в «Проверке заполнения» вариант «Выдавать ошибку» и поставив флаг «Заполнять из данных заполнения»:
тип — ПеречислениеСсылка.ТипыНоменклатуры;
номенклатурнаяГруппа — СправочникСсылка.НоменклатурныеГруппы;
ставкаНДС — ПеречислениеСсылка.СтавкиНДС;

![Реквизиты](%D0%A0%D0%B5%D0%BA%D0%B2%D0%B8%D0%B7%D0%B8%D1%82%D1%8B.png)

в модуле объекта переопределить событие «ОбработкаЗаполнения», заполнив тип и ставку НДС значениями по умолчанию: «Товар», «НДС20». Заполнять только для элемента, для группы эти реквизиты не определены;

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, ТекстЗаполнения, СтандартнаяОбработка) 
	
	СтандартнаяОбработка = Ложь;
	
	Если ЭтотОбъект.ЭтоГруппа = Ложь  Тогда
		Тип = Перечисления.ТипыНоменклатуры.Товар;
		СтавкаНДС = Перечисления.СтавкиНДС.НДС20;
	КонецЕсли;	

КонецПроцедуры

Добавить регистр сведений «Цены»:
установить периодичность «По позиции регистратора» и режим записи «Подчинение регистратору»;
добавить измерение «Номенклатура» (СправочникСсылка.Номенклатура) с флагом «Ведущее» и ресурс «Цена» (ОпределяемыйТип.Сумма);
!Регистр сведений](%D0%A0%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%20%D1%81%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B9.jpg)
![Свойства](%D0%A1%D0%B2%D0%BE%D0%B9%D1%81%D1%82%D0%B2%D0%B0.png)
 
добавить общий модуль «ЦеныСервер» с флажками «Сервер» и «Внешнее соединение» и создать в нём экспортную функцию «ЦенаНаДату»(Номенклатура, Дата), которая получит запросом срез последних на указанную дату с отбором по номенклатуре и вернёт цену;

# Решение
Функция ЦеныНаДату(Номенклатура,Дата) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЦеныСрезПоследних.Номенклатура КАК Номенклатура,
		|	ЦеныСрезПоследних.Цена КАК Цена
		|ИЗ
		|	РегистрСведений.Цены.СрезПоследних(
		|			&Период,
		|			Номенклатура В
		|				(ВЫБРАТЬ
		|					ЦеныСрезПоследних.Номенклатура КАК Номенклатура
		|				ИЗ
		|					РегистрСведений.Цены.СрезПоследних КАК ЦеныСрезПоследних
		|				ГДЕ
		|					ЦеныСрезПоследних.Номенклатура = &Номенклатура)) КАК ЦеныСрезПоследних";
	
	Запрос.УстановитьПараметр("Номенклатура", Номенклатура);
	Запрос.УстановитьПараметр("Период", Дата);
	
  Результат = Запрос.Выполнить();
       
    Выборка = Результат.Выбрать();

	Пока Выборка.Следующий() Цикл
		
		Цена = Выборка.Цена;
	
	КонецЦикла; 
	
	Возврат Цена;
КонецФункции

добавить общий модуль «ЦеныВызовСервера» с флажками «Сервер», «Внешнее соединение» и «Вызов сервера» и создать в нём функцию «ЦенаНаДату» для вызова из клиентского кода форм, которая вызовет одноимённую функцию из модуля «ЦеныСервер».
# Решение
Функция ЦенаНаДату(Номенклатура,Дата) Экспорт

Возврат ЦеныСервер.ЦеныНаДату(Номенклатура,Дата);	

КонецФункции

   
* регистром сведений **«Скидки»**, который:
   * содержит измерение «НоменклатураНоменклатурнаяГруппа» и ресурс «Скидка»;
   * является периодическим с подчинением регистратору (документу **«УстановкаСкидок»**);
   
* журналом документов **«ЦеныИСкидки»**, который:
   * содержит документы **«УстановкаЦен»** и **«УстановкаСкидок»** и графу «Ответственный».

Подсистемой **«Сделки»**, а в ней:

* документом **«ПоступлениеТоваровИУслуг»**, который:
   * содержит реквизиты шапки «Поставщик», «Ответственный», «Сумма» и табличную часть «ТоварыИУслуги» с реквизитами «Номенклатура», «Количество», «Цена», «Сумма», «СтавкаНДС», «СуммаНДС»;
   * имеет форму, в которой реализован выбор и подбор номенклатуры с автоматическим пересчётом числовых колонок по правилам:
      * при изменении реквизитов «Количество» и «Цена» пересчитывается «Сумма» и «СуммаНДС» (см. ниже «Правила расчёта НДС»);
      * при изменении реквизита «Сумма» пересчитывается «Цена» и «СуммаНДС»;
      * при изменении реквизита «СтавкаНДС» пересчитывается «СуммаНДС»;
   * перед записью заполняет реквизит шапки «Сумма» итогом по одноимённой колонке табличной части;
   * формирует движения:
      * расход по регистру накопления **«ВзаиморасчетыСКонтрагентами»** с указанием поставщика в сумме общего итога по реквизиту ТЧ «Сумма»;
      * приход по регистру накопления **«Товары»** в разрезе номенклатуры типа «Товар» согласно реквизитам ТЧ «Количество» и «Сумма»;
      * движения по регистру накопления **«Расходы»** в разрезе номенклатуры типа «Услуга» согласно реквизиту ТЧ «Сумма»;

* документом **«РеализацияТоваровИУслуг»**, который:
   * содержит реквизит шапки «Покупатель», «Ответственный», «Сумма» и табличную часть «ТоварыИУслуги» с реквизитами «Номенклатура», «Количество», «Скидка», «Цена», «Сумма», «СтавкаНДС», «СуммаНДС»;
   * имеет форму, в которой реализован выбор и подбор номенклатуры с автоматическим назначением цены и скидки, а также пересчётом числовых колонок по правилам:
      * при изменении реквизитов «Количество» и «Цена» пересчитывается «Сумма» с учётом скидки и «СуммаНДС» (см. ниже «Правила расчёта НДС»);
      * при изменении реквизита «Скидка» пересчитывается «Сумма» и «СуммаНДС» (см. ниже «Применение скидок»);
      * при изменении реквизита «Сумма» пересчитывается «СуммаНДС»;
      * при изменении реквизита «СтавкаНДС» пересчитывается «СуммаНДС»;
   * перед записью заполняет реквизит шапки «Сумма» итогом по одноимённой колонке табличной части;
   * формирует движения:
      * приход по регистру накопления **«ВзаиморасчетыСКонтрагентами»** с указанием покупателя в сумме общего итога по реквизиту ТЧ «Сумма»;
      * расход по регистру накопления **«Товары»** в разрезе номенклатуры типа «Товар» согласно реквизиту ТЧ «Количество» и сумме, определённой согласно средней стоимости остатков этого товара. В отсутствие достаточного остатка проведение не выполняется;
      * движения по регистру накопления **«Расходы»** в разрезе номенклатуры типа «Товар» в сумме себестоимости продаж (сумме расхода по регистру «Товары»);
      * движения по регистру накопления **«Доходы»** в разрезе номенклатуры всех типов согласно реквизиту ТЧ «Сумма»;
      
* журналом документов **«Сделки»**, который:
   * содержит документы **«ПоступлениеТоваровИУслуг»** и **«РеализацияТоваровИУслуг»** с графами «Контрагент», «Ответственный» и «Сумма».